# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è REST API v3 –¥–ª—è ModuleUsersGroups

## üì¶ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

### –ö–æ–¥
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `Lib/UsersGroupsConf.php`
- [x] –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `SystemMessages`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `onAfterExecuteRestAPIRoute()`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ REST API v3
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º API
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] CHANGELOG_REST_API_V3.md - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] TEST_REST_API_V3.md - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- [x] SUMMARY.md - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
- [x] CHECKLIST.md - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] **–¢–µ—Å—Ç 1:** –°–æ–∑–¥–∞–Ω–∏–µ employee —á–µ—Ä–µ–∑ REST API v3 —Å –≥—Ä—É–ø–ø–æ–π
  ```bash
  curl -X POST http://localhost/pbxcore/api/v3/employees \
    -H "Authorization: Bearer TOKEN" \
    -d '{"number":"301","user_username":"Test","sip_secret":"pass","mod_usrgr_select_group":"1"}'
  ```
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP 201 Created
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `REST API v3: Updated group...`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: –∑–∞–ø–∏—Å—å –≤ `m_ModuleUsersGroups_GroupMembers`

- [ ] **–¢–µ—Å—Ç 2:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ employee —á–µ—Ä–µ–∑ REST API v3 (—Å–º–µ–Ω–∞ –≥—Ä—É–ø–ø—ã)
  ```bash
  curl -X PUT http://localhost/pbxcore/api/v3/employees/42 \
    -H "Authorization: Bearer TOKEN" \
    -d '{"number":"301","user_username":"Test","sip_secret":"pass","mod_usrgr_select_group":"2"}'
  ```
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP 200 OK
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä—É–ø–ø–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –≤ –ë–î

- [ ] **–¢–µ—Å—Ç 3:** –°–æ–∑–¥–∞–Ω–∏–µ employee –±–µ–∑ –≥—Ä—É–ø–ø—ã
  ```bash
  curl -X POST http://localhost/pbxcore/api/v3/employees \
    -d '{"number":"302","user_username":"NoGroup","sip_secret":"pass"}'
  ```
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å employee —Å–æ–∑–¥–∞–Ω
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä—É–ø–ø–∞ –ù–ï –Ω–∞–∑–Ω–∞—á–µ–Ω–∞

- [ ] **–¢–µ—Å—Ç 4:** –°—Ç–∞—Ä—ã–π API (–≤–µ–±-—Ñ–æ—Ä–º–∞)
  - [ ] –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è extension
  - [ ] –í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä—É–ø–ø–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∏

- [ ] **–õ–æ–≥–∏**
  ```bash
  tail -20 /var/log/messages | grep ModuleUsersGroups
  ```
  - [ ] –í–∏–¥–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è `REST API v3: Updated group...`

- [ ] **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
  ```bash
  sqlite3 /cf/conf/mikopbx.db \
    "SELECT * FROM m_ModuleUsersGroups_GroupMembers LIMIT 5"
  ```
  - [ ] –ó–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] –°–≤—è–∑–∏ —Å Users —Ä–∞–±–æ—Ç–∞—é—Ç

- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  - [ ] –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
  - [ ] –õ–æ–≥–∏ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç—Å—è

## üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] **Backup**
  ```bash
  cp -r /var/www/mikopbx/ModuleUsersGroups /backup/ModuleUsersGroups_$(date +%Y%m%d)
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ MikoPBX**
  ```bash
  cat /offload/version
  ```
  - [ ] –í–µ—Ä—Å–∏—è >= 2024.1.0 (–¥–ª—è REST API v3)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

- [ ] **–ó–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–∞**
  ```bash
  # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π UsersGroupsConf.php
  cp UsersGroupsConf.php /var/www/mikopbx/ModuleUsersGroups/Lib/
  ```

- [ ] **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
  ```bash
  chown www:www /var/www/mikopbx/ModuleUsersGroups/Lib/UsersGroupsConf.php
  chmod 644 /var/www/mikopbx/ModuleUsersGroups/Lib/UsersGroupsConf.php
  ```

- [ ] **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫**
  ```bash
  pkill -USR2 php-fpm
  ```
  –∏–ª–∏
  ```bash
  /etc/rc/restart_phalcon
  ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] **–°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã**
  ```bash
  ps aux | grep php-fpm
  ps aux | grep nginx
  ```

- [ ] **–õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫**
  ```bash
  tail -50 /var/log/messages | grep -i error
  tail -50 /var/log/php/error.log
  ```

- [ ] **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω**
  - [ ] –û—Ç–∫—Ä—ã—Ç—å http://pbx/admin-cabinet
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

- [ ] **–ú–æ–¥—É–ª—å –∞–∫—Ç–∏–≤–µ–Ω**
  - [ ] Modules ‚Üí ModuleUsersGroups ‚Üí Status: Enabled

## üîÑ Smoke Testing (–ø—Ä–æ–¥–∞–∫—à–Ω)

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

- [ ] **–°–æ–∑–¥–∞–Ω–∏–µ employee —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
  - [ ] Extensions ‚Üí Add new
  - [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É —Å –≤—ã–±–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä—É–ø–ø–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞

- [ ] **–°–æ–∑–¥–∞–Ω–∏–µ employee —á–µ—Ä–µ–∑ REST API v3**
  - [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å POST –∑–∞–ø—Ä–æ—Å —Å –≥—Ä—É–ø–ø–æ–π
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP 201
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

- [ ] **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ employee**
  - [ ] –ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ PUT –∑–∞–ø—Ä–æ—Å
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP 200
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä—É–ø–ø–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞)

- [ ] **–õ–æ–≥–∏**
  ```bash
  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  watch -n 60 'tail -20 /var/log/messages | grep -i "usersgroups\|error"'
  ```

- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  ```bash
  top -b -n 1 | grep php-fpm
  ```

- [ ] **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π**
  ```bash
  grep "REST API v3" /var/log/messages | wc -l
  ```

## üêõ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç

- [ ] **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backup**
  ```bash
  rm -rf /var/www/mikopbx/ModuleUsersGroups
  cp -r /backup/ModuleUsersGroups_YYYYMMDD /var/www/mikopbx/ModuleUsersGroups
  ```

- [ ] **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫**
  ```bash
  pkill -USR2 php-fpm
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**
  ```bash
  tail -20 /var/log/messages
  ```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PHP**
  ```bash
  php -l /var/www/mikopbx/ModuleUsersGroups/Lib/UsersGroupsConf.php
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫**
  ```bash
  tail -50 /var/log/php/error.log
  tail -50 /var/log/nginx/error.log
  ```

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã**
  ```bash
  grep "use MikoPBX" /var/www/mikopbx/ModuleUsersGroups/Lib/UsersGroupsConf.php
  ```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

- [ ] **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
  - [ ] –°—Ç–∞—Ä—ã–π API —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - [ ] REST API v3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≥—Ä—É–ø–ø—ã
  - [ ] –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  - [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ < 500ms
  - [ ] CPU usage –Ω–µ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
  - [ ] Memory usage –≤ –Ω–æ—Ä–º–µ

- [ ] **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
  - [ ] –ù–µ—Ç PHP Fatal Errors
  - [ ] –ù–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –ª–æ–≥–∞—Ö
  - [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- [ ] –û–±–Ω–æ–≤–∏—Ç—å README –º–æ–¥—É–ª—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –û–±–Ω–æ–≤–∏—Ç—å changelog –º–æ–¥—É–ª—è

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–æ–≤

- [ ] –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å TEST_REST_API_V3.md
- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å –Ω–æ–≤—ã–µ endpoint'—ã
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏

### –î–ª—è DevOps

- [ ] –û–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

## üéì –û–±—É—á–µ–Ω–∏–µ

- [ ] **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥–µ**
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤—ã–π API
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
  - [ ] –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

- [ ] **–ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
  - [ ] PHP –ø—Ä–∏–º–µ—Ä
  - [ ] JavaScript –ø—Ä–∏–º–µ—Ä
  - [ ] cURL –∫–æ–º–∞–Ω–¥—ã

## ‚ú® –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] Backup —Å–¥–µ–ª–∞–Ω
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- [ ] Smoke testing –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –ö–æ–º–∞–Ω–¥–∞ –æ–±—É—á–µ–Ω–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## üéâ –ì–æ—Ç–æ–≤–æ!

–ö–æ–≥–¥–∞ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã, –º–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

**–í–∞–∂–Ω–æ:** –î–µ—Ä–∂–∏—Ç–µ —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ—Ç–º–µ—á–∞–π—Ç–µ –ø—É–Ω–∫—Ç—ã –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
- GitHub Issues: https://github.com/mikopbx/Core/issues
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: docs/
